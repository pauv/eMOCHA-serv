<?xml version="1.0"?>
<h:html xmlns="http://www.w3.org/2002/xforms" 
				xmlns:h="http://www.w3.org/1999/xhtml" 
				xmlns:ev="http://www.w3.org/2001/xml-events" 
				xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
				xmlns:jr="http://openrosa.org/javarosa">
	<h:head>
		<h:title>Circumcision follow up</h:title>
		
		<model>			
			<itext>
			  <translation lang="English">
			    <text id="scheduled_fu_visit_date">
			      <value>Skip if no visit scheduled</value>
			    </text>
			  </translation>
			</itext>
			<instance>
				<data>
			        <meta>
						<form_name>Circ FU</form_name>
						<form_version>0.0.3</form_version>
						<start/>
						<end/>
						<today/>
						<device_id/>
						<subscriber_id/>
						<sim_id/>
					</meta>
					
					<visited_circum_clinic />
					<got_circum />
					<recommends_clinic />
					<why_doesnt_recommend_clinic />
					<what_prevented_circum />
					<planning_circum />
					<provide_info />
					<scheduled_fu_visit_done />
					<scheduled_fu_visit_date />
					<why_didnt_visit_clinic />

					<emocha_data>
						<phone_id />										
						<village_code />
						<household_code />
						<patient_code />										
						<referral_done />										
					</emocha_data>
				</data>
			</instance>

			<bind nodeset="/data/meta/start" type="dateTime" jr:preload="timestamp" jr:preloadParams="start"/>
			<bind nodeset="/data/meta/end" type="dateTime" jr:preload="timestamp" jr:preloadParams="end"/>
			<bind nodeset="/data/meta/today" type="date" jr:preload="date" jr:preloadParams="today"/>
			<bind nodeset="/data/meta/device_id" type="string" jr:preload="property" jr:preloadParams="deviceid"/>
			<bind nodeset="/data/meta/subscriber_id" type="string" jr:preload="property" jr:preloadParams="subscriberid"/>
			<bind nodeset="/data/meta/sim_id" type="string" jr:preload="property" jr:preloadParams="simserial"/>
			
			<!-- Questions -->
			<bind nodeset="/data/visited_circum_clinic" required="true()" type="string" />
			
			<bind nodeset="/data/got_circum" required="true()" type="string" 
				relevant="/data/visited_circum_clinic = '1'" />		
			<bind nodeset="/data/recommends_clinic" required="true()" type="string" 
				relevant="/data/got_circum = '1'" />			
			<bind nodeset="/data/why_doesnt_recommend_clinic" required="true()" type="string" 
				relevant="/data/recommends_clinic = '0'" />
			
			<bind nodeset="/data/what_prevented_circum" required="true()" type="string" 
				relevant="/data/got_circum != '' and /data/got_circum != '1'" 
				constraint="count-selected(.) &lt;= 1 or not(selected(., '77') or selected(., '99'))" 
				jr:constraintMsg="only 1 option can be set when declined or doesn't know" />
			
			<bind nodeset="/data/why_didnt_visit_clinic" required="true()" type="string" 
				relevant="/data/visited_circum_clinic != '1'"
				constraint="count-selected(.) &lt;= 1 or not(selected(., '77') or selected(., '99'))" 
				jr:constraintMsg="only 1 option can be set when declined or doesn't know" />
			
			<bind nodeset="/data/planning_circum" required="true()" type="string" 
				relevant="/data/visited_circum_clinic != '1' or /data/got_circum != '1'" />
			<bind nodeset="/data/provide_info" required="true()" type="string" 
				relevant="/data/visited_circum_clinic != '1' or /data/got_circum != '1'" />
			<bind nodeset="/data/scheduled_fu_visit_date" required="false()" type="date" 
				constraint=". &gt;= today()" 
				jr:constraintMsg="only future dates allowed" 
				relevant="/data/visited_circum_clinic != '1' or /data/got_circum != '1'" />
			<bind nodeset="/data/scheduled_fu_visit_done" type="string" 
				calculate="if(/data/scheduled_fu_visit_date &gt; today(), '1', '0')" 
				relevant="/data/visited_circum_clinic != '1' or /data/got_circum != '1'" />
			
			<!-- emocha related data -->
			<bind nodeset="/data/emocha_data/phone_id" type="int" calculate="-1" />
			<bind nodeset="/data/emocha_data/village_code" type="int" calculate="-1" />
			<bind nodeset="/data/emocha_data/household_code" type="string" calculate="-1" />
			<bind nodeset="/data/emocha_data/patient_code" type="string" calculate="-1" />
			<bind nodeset="/data/emocha_data/referral_done" type="int" calculate="0" />
			<!-- end emocha data-->
		</model>
	</h:head>
	<h:body>
		<select1 ref="visited_circum_clinic">
			<label>Since I last saw you, did you visit the clinic where you can get circumcised?</label>
			<item><value>0</value><label>No</label></item>
			<item><value>1</value><label>Yes</label></item>
			<item><value>99</value><label>Declined to answer</label></item>
		</select1>

		<select1 ref="got_circum">
			<label>Did you get circumcised?</label>
			<item><value>0</value><label>No</label></item>
			<item><value>1</value><label>Yes</label></item>
			<item><value>99</value><label>Declined to answer</label></item>
		</select1>

		<select1 ref="recommends_clinic">
			<label>Would you recommend circumcision at this clinic?</label>
			<item><value>0</value><label>No</label></item>
			<item><value>1</value><label>Yes</label></item>
			<item><value>77</value><label>Don't Know</label></item>
			<item><value>99</value><label>Declined to answer</label></item>
		</select1>

		<select ref="why_doesnt_recommend_clinic">
			<label>Why wouldn't you recommend this clinic?</label>
			<item><value>1</value><label>long wait time</label></item>
			<item><value>2</value><label>expensive</label></item>
			<item><value>3</value><label>didn't like the health care provider</label></item>
			<item><value>4</value><label>didn't like the facilities</label></item>
			<item><value>5</value><label>service was bad</label></item>
			<item><value>6</value><label>other</label></item>
		</select>

		<select ref="what_prevented_circum">
			<label>What factors prevented you from getting circumcised?</label>
			<item><value>1</value><label>Cost of the procedure</label></item>
			<item><value>2</value><label>Fear of pain</label></item>
			<item><value>3</value><label>Cultural norms</label></item>
			<item><value>4</value><label>Religion</label></item>
			<item><value>5</value><label>Fear of complications</label></item>
			<item><value>6</value><label>No service at near health facility</label></item>
			<item><value>7</value><label>Wait times were too long</label></item>
			<item><value>8</value><label>Didn't like the health care provider</label></item>
			<item><value>9</value><label>Didn't like the facilities</label></item>
			<item><value>10</value><label>service was bad</label></item>
			<item><value>11</value><label>other</label></item>
			<item><value>77</value><label>Don't know</label></item>
			<item><value>99</value><label>Declined to answer</label></item>
		</select>

		<select ref="why_didnt_visit_clinic">
			<label>What factors prevented you from visiting the clinic?</label>
			<item><value>1</value><label>Cost of transportation</label></item>
			<item><value>2</value><label>Loss of work</label></item>
			<item><value>3</value><label>Didn't have time</label></item>
			<item><value>4</value><label>Didn't want to get circumcised</label></item>
			<item><value>77</value><label>Don't know</label></item>
			<item><value>99</value><label>Declined to answer</label></item>
		</select>

		<select1 ref="planning_circum">
			<label>As of today, are you planning to get circumcised?</label>
			<item><value>0</value><label>Don't see a need</label></item>
			<item><value>1</value><label>Might be good, but I'm not ready to do it</label></item>
			<item><value>77</value><label>I plan to do it</label></item>
			<item><value>99</value><label>Declined to answer</label></item>
		</select1>

		<select1 ref="provide_info">
			<label>Provide counseling/information as needed</label>
			<item><value>0</value><label>Not Done</label></item>
			<item><value>1</value><label>Done</label></item>
		</select1>

		<input ref="scheduled_fu_visit_date">
			<label>Schedule follow-up visit</label>
			<hint ref="jr:itext('scheduled_fu_visit_date')"></hint>
		</input>

	</h:body>
</h:html>
