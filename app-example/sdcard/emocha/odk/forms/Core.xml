<?xml version="1.0"?>
<h:html xmlns="http://www.w3.org/2002/xforms" 
				xmlns:h="http://www.w3.org/1999/xhtml" 
				xmlns:ev="http://www.w3.org/2001/xml-events" 
				xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
				xmlns:jr="http://openrosa.org/javarosa">
	<h:head>
		<h:title>MP3 core</h:title>
		
		<model>
			<instance>
				<data>
			        <meta>
						<form_name>Core Questionnaire</form_name>
						<form_version>0.0.3</form_version>
						<start/>
						<end/>
						<today/>
						<device_id/>
						<subscriber_id/>
						<sim_id/>
					</meta>
					
					<counselor_initials />

					<location>
						<district_code />
						<subcounty_code />
						<parish_code />
						<village_code />
						<health_subdistrict_code />
						<gps_coordinates />
						<gps_description />
					</location>
					
					<household>
						<adults_living />
						<adults_present />
						<adults_missing />
												
						<missing_people>
							<person jr:template="">
								<person_id />
								<age />
								<sex />
							</person>
						</missing_people>
					</household>

					<emocha_data>
						<phone_id />										
						<village_code />
						<household_code />
						<patient_code />										
						<referral_done />										
					</emocha_data>
				</data>
			</instance>

			<bind nodeset="/data/meta/start" type="dateTime" jr:preload="timestamp" jr:preloadParams="start"/>
			<bind nodeset="/data/meta/end" type="dateTime" jr:preload="timestamp" jr:preloadParams="end"/>
			<bind nodeset="/data/meta/today" type="date" jr:preload="date" jr:preloadParams="today"/>
			<bind nodeset="/data/meta/device_id" type="string" jr:preload="property" jr:preloadParams="deviceid"/>
			<bind nodeset="/data/meta/subscriber_id" type="string" jr:preload="property" jr:preloadParams="subscriberid"/>
			<bind nodeset="/data/meta/sim_id" type="string" jr:preload="property" jr:preloadParams="simserial"/>

			<!-- Questions -->
			
			<bind nodeset="/data/counselor_initials" type="string" />
			
			<bind nodeset="/data/location/district_code" type="int" />
			<bind nodeset="/data/location/subcounty_code" type="int" />
			<bind nodeset="/data/location/parish_code" type="int" />
			<bind nodeset="/data/location/village_code" type="int" required="true()" />
			<bind nodeset="/data/location/health_subdistrict_code" type="int" />
			<bind nodeset="/data/location/gps_coordinates" type="geopoint" />
			<bind nodeset="/data/location/gps_description" type="string" />

			<bind nodeset="/data/household/adults_living" type="int" constraint=". &lt;= 999" jr:constraintMsg="maximum is 999" />
			<bind nodeset="/data/household/adults_present" type="int" constraint=". &lt;= ../adults_living" jr:constraintMsg="more people present than living in this household" />
			
			<bind nodeset="/data/household/adults_missing" type="int" calculate="/data/household/adults_living - /data/household/adults_present" />
			
			<bind nodeset="/data/household/missing_people/person/person_id" type="int" calculate="createRepeatNodeId(/data/household/adults_missing)" />
			<bind nodeset="/data/household/missing_people/person/age" type="int" required="true()" constraint=". &gt;= 18" jr:constraintMsg="Individual can't be under 18. Change the age or modify 'Number of adults present'" />
			<bind nodeset="/data/household/missing_people/person/sex" type="string" relevant="/data/household/missing_people/person/age &gt;= 18" />

			<!-- emocha related data -->
			<bind nodeset="/data/emocha_data/phone_id" type="int" calculate="-1" />
			<bind nodeset="/data/emocha_data/village_code" type="int" calculate="/data/location/village_code" />
			<bind nodeset="/data/emocha_data/household_code" type="string" calculate="-1" />
			<bind nodeset="/data/emocha_data/patient_code" type="string" calculate="-1" />
			<bind nodeset="/data/emocha_data/referral_done" type="int" calculate="0" />
			<!-- end emocha data-->
		</model>
	</h:head>
	<h:body>


<!-- Screen 1: Pre-questionnaire information collected per household -->

<!-- Basic Information -->

		<!-- Q1-Date, is entered automatically. dd/mmm/yy-->

		<!--text-->
		<input ref="counselor_initials">
			<label>Counselor Initials</label>
		</input>

<!-- Location Information -->

		<!--number Q1-->
		<input ref="location/district_code">
			<label>District Code</label>
		</input>

		<!--number Q2-->
		<input ref="location/subcounty_code">
			<label>Sub-county Code</label>
		</input>

		<!--number Q3-->
		<input ref="location/parish_code">
			<label>Parish Code</label>
		</input>

		<!--number Q4-->
		<input ref="location/village_code">
			<label>Village Code</label>
		</input>

		<!--number Q5-->
		<input ref="location/health_subdistrict_code">
			<label>Health Sub-district Code</label>
		</input>

		<!--gps Q6-->
		<input ref="location/gps_coordinates">
			<label>Household GPS Coordinates</label>
		</input>

		<input ref="location/gps_description">
			<label>Enter Household location description (optional)</label>
		</input>
<!-- Household information -->

		<!-- Q8-->
		<input ref="household/adults_living">
			<label>Number of adults who live in household (present and not present)</label>
		</input>

		<!-- Q9-->
		<input ref="household/adults_present">
			<label>Number of adults present for testing today</label>
		</input>

		<!-- loop Q10 and Q11 (Q8-Q9 times) -->

		<group>
			<label>Person not present</label>
			
			<repeat nodeset="/data/household/missing_people/person" jr:noAddRemove="true()" jr:count="/data/household/adults_missing">
			
				<!--number Q10-->
				<input ref="age">
					<label>Age</label>
				</input>
		
				<!--text Q11-->
				<select1 ref="sex">
					<label>Sex</label>
					<item><value>0</value><label>Male</label></item>
					<item><value>1</value><label>Female</label></item>
				</select1>
			</repeat>
		</group>

	</h:body>
</h:html>
