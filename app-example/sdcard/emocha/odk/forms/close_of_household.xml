<?xml version="1.0"?>
<h:html xmlns="http://www.w3.org/2002/xforms" xmlns:h="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa">
	<h:head>
		<h:title>Close of the Household Questionnaire</h:title>

		<model>
			<instance>
				<data>
					<meta>
						<form_name>Close of the Household Questionnaire</form_name>
						<form_version>0.0.1</form_version>
						<start />
						<end />
						<today />
						<device_id />
						<subscriber_id />
						<sim_id />
					</meta>
					
					<couple_tested />
					<tested_couple>
						<closing_study_id_A />
						<closing_study_id_B />
						<members_disclose_results />
						<discordant_results />
					</tested_couple>
					<emocha_data>
						<phone_id />										
						<village_code />
						<household_code />
						<patient_code />										
						<referral_done />										
					</emocha_data>
					<!-- used to load data from the android activity -->
					<dynamic_data>
						<closing_study_id_A>
							<item>
								<value />
								<label />
							</item>
						</closing_study_id_A>
						<closing_study_id_B>
							<item>
								<value />
								<label />
							</item>
						</closing_study_id_B>
					</dynamic_data>
					<!-- -->
				</data>
			</instance>

			<bind nodeset="/data/meta/start" type="dateTime" jr:preload="timestamp" jr:preloadParams="start" />
			<bind nodeset="/data/meta/end" type="dateTime" jr:preload="timestamp" jr:preloadParams="end" />
			<bind nodeset="/data/meta/today" type="date" jr:preload="date" jr:preloadParams="today" />
			<bind nodeset="/data/meta/device_id" type="string" jr:preload="property" jr:preloadParams="deviceid" />
			<bind nodeset="/data/meta/subscriber_id" type="string" jr:preload="property" jr:preloadParams="subscriberid" />
			<bind nodeset="/data/meta/sim_id" type="string" jr:preload="property" jr:preloadParams="simserial" />

			<!-- Questions -->

			<bind nodeset="/data/couple_tested" type="string" required="true()" />
			<bind nodeset="/data/tested_couple" relevant="/data/couple_tested = 1" />
			<bind nodeset="/data/tested_couple/closing_study_id_A" type="string" required="true()" />
			<bind nodeset="/data/tested_couple/closing_study_id_B" type="string" required="true()" />
			<bind nodeset="/data/tested_couple/members_disclose_results" type="string" />
			<bind nodeset="/data/tested_couple/discordant_results" type="string" />

			<!-- emocha related data -->
			<bind nodeset="/data/emocha_data/phone_id" type="int" calculate="-1" />
			<bind nodeset="/data/emocha_data/village_code" type="int" calculate="-1" />
			<bind nodeset="/data/emocha_data/household_code" type="string" calculate="-1" />
			<bind nodeset="/data/emocha_data/patient_code" type="string" calculate="-1" />
			<bind nodeset="/data/emocha_data/referral_done" type="int" calculate="0" />
			<!-- end emocha data-->
		</model>
	</h:head>
	<h:body>

		<select1 ref="couple_tested">
			<label>Was any couple tested together today?</label>
			<item><value>0</value><label>No</label></item>
			<item><value>1</value><label>Yes</label></item>
		</select1>

		<group>
			<label>Tested Couple</label>
			
			<repeat nodeset="/data/tested_couple" >
			
				<!--text Q1-->
				<select1 ref="closing_study_id_A">
					<label>Please choose male's name</label>
					<itemset nodeset="/data/dynamic_data/closing_study_id_A/item"><value ref="value" /><label ref="label" /></itemset>
				<!--	<item><value></value><label></label></item> -->
				</select1>

				<!--text Q2-->
				<select1 ref="closing_study_id_B">
					<label>Please choose female's name</label>
					<itemset nodeset="/data/dynamic_data/closing_study_id_B/item"><value ref="value" /><label ref="label" /></itemset>
				<!--	<item><value></value><label></label></item> -->
				</select1>

				<!--text Q3-->
				<select1 ref="members_disclose_results">
					<label>Did both members of the couple disclose HIV results to each other?</label>
					<item><value>0</value><label>No</label></item>
					<item><value>1</value><label>Yes</label></item>
				</select1>
		
				<!--text Q3-->
				<select1 ref="discordant_results">
					<label>Does this couple have discordant HIV results?</label>
					<item><value>0</value><label>No</label></item>
					<item><value>1</value><label>Yes</label></item>
				</select1>
			</repeat>
		</group>
	</h:body>
</h:html>
